<!DOCTYPE html>
  <html>
    <head>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
      <script src="https://cdn.firebase.com/libs/firebaseui/2.4.1/firebaseui.js"></script>
      <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/2.4.1/firebaseui.css">
      <link rel="stylesheet" type="text/css" href="./style.css">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.1/css/bulma.css">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Pic A or B</title>
    </head>
    <body class="body index">
      <div class="tile is-ancestor">
        <div class="tile is-vertical is-8">
          <div class="tile">
            <div class="tile is-parent is-vertical">
              <article class="tile is-child notification is-primary">
                <p class="title">What is Pic A or B?</p>
                <p>Have you ever wanted to A/B Test two things to find out what people like best? Now there's an easy way to do it using Twitter and your smartphone. </p>
              </article>
              <article class="tile is-child notification is-warning">
                <p class="title">How it works:</p>
                <p>Simply tweet two pictures of the things that you want to compare to  <a href="https://twitter.com/picaorb">@picAorB</a> sit back and wait for the crowdsourced results.</p>
              </article>
            </div>
            <div class="tile is-parent">
              <article class="tile is-child notification is-info">
                <p class="title">Pick A or B</p>
                <p class="subtitle">With pic A or B</p>
                <figure class="image is-4by3">
                  <img src="logo.png">
                </figure>
              </article>
            </div>
          </div>
          <div class="tile is-parent">
            <article class="tile is-child notification is-danger">
              <p class="title">Track your A/B tweet here:</p>
              <p class="subtitle">Input your Tweet ID to track the status of your A/B Test</p>
              <div class="content">
                <p>The Tweet ID is a unique identifier that Twitter randomly assigns to every tweet.  You can find this ID in the automated reply to your original tweet.</p>

                <form id="track-form">
                  <input type="text" id="track-status" placeholder="e.g. 932753619702702100">
                  <input id="track-submit" type="submit" value="submit">
                </form>
              </div>
            </article>
          </div>
        </div>
        <div class="tile is-parent">
          <div class="tile is-child notification is-success">
              <p class="title">Your A/B Test:</p>
              <div id="display-tweet"></div>
          </div>
        </div>
      </div>

    </body>
  </html>

<script src="https://www.gstatic.com/firebasejs/4.6.2/firebase.js"></script>
<script>
  // Initialize Firebase
    var config = {
      apiKey: "AIzaSyAgyDSwIZzynPdq5OvN1pVTbg60D67U91g",
      authDomain: "picaorb-project2.firebaseapp.com",
      databaseURL: "https://picaorb-project2.firebaseio.com",
      projectId: "picaorb-project2",
      storageBucket: "picaorb-project2.appspot.com",
      messagingSenderId: "1007298219380"
    };
    firebase.initializeApp(config);


var tweetToTrack;
var tweetPic;

$("#track-submit").on("click", function(event) {
  event.preventDefault();
  tweetToTrack = $("#track-status").val().trim();
  // console.log(tweetToTrack);
  $('#track-status').val('');
  trackStatus();
});

// this function gets called when a user submits a request via the input field
// it takes a snapshot of the database, then searches for the ID submitted by the User

  function trackStatus() {
    var query = firebase.database().ref('activePolls');
    query.once('value')
    .then (function(snapshot){
      snapshot.forEach(function(snap) {
        var idString = (snap.child('id_str').val());
        if (idString == tweetToTrack) {
          var picA = snap.child('extended_entities/media').child('0/media_url').val();
          var picB = snap.child('extended_entities/media').child('1/media_url').val();
          console.log(picA);
          console.log(picB);
          $("#display-tweet").empty();
          var displayTweetDiv = $('<div>');
          displayTweetDiv.html("<p>Pic A:</p><img src=" + picA +"><p>Pic B:</p><img src=" + picB +">");
          $("#display-tweet").append(displayTweetDiv);
        };
      });
    });
  };



</script>
