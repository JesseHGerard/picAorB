<!DOCTYPE html>
  <html>
    <head>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
      <script src="https://cdn.firebase.com/libs/firebaseui/2.4.1/firebaseui.js"></script>
      <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/2.4.1/firebaseui.css">
      <link rel="stylesheet" type="text/css" href="./style.css">
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.6.1/css/bulma.css">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>A/B Testing</title>
    </head>
    <body class="body index">
      <p class="title">Pic A or B</p>
      <h1 style="text-align:center">Click on the image below that you like better:</h1>
      <hr>

      <div class="tile is-ancestor is-primary">
        <div class="tile is-1"></div>
        <div class="tile box" id="pic-A">
        </div>
        <div class="tile is-1"></div>
        <div class="tile box" id="pic-B">
        </div>
        <div class="tile is-1"></div>
      </div> <!-- end of ancestor tile -->
    </body>
  </html>

  <script src="https://www.gstatic.com/firebasejs/4.6.2/firebase.js"></script>
  <script>
    // Initialize Firebase
      var config = {
        apiKey: "AIzaSyAgyDSwIZzynPdq5OvN1pVTbg60D67U91g",
        authDomain: "picaorb-project2.firebaseapp.com",
        databaseURL: "https://picaorb-project2.firebaseio.com",
        projectId: "picaorb-project2",
        storageBucket: "picaorb-project2.appspot.com",
        messagingSenderId: "1007298219380"
      };
      firebase.initializeApp(config);

    //these arrays are used in the compareAB function to randomize which images appear in the div
    var tweetArrA = [];
    var tweetArrB = [];
    var picADiv = $('<div>');
    var picBDiv = $('<div>');

    //this function takes a snapshot of the database, then looks for any tweets that have two images
    //if a tweet has two pics, those pics are pushed to arrays, the randomizer selects a random pair of images
    //from the arrays and displays them 
    function compareAB() {
      var query = firebase.database().ref('activePolls');
      query.once('value')
      .then (function(snapshot){
        snapshot.forEach(function(snap) {
          if (snap.hasChild("extended_entities")) {
            var picA = snap.child('extended_entities/media').child('0/media_url').val();
            var picB = snap.child('extended_entities/media').child('1/media_url').val();
            if (picA != null && picB != null) {
              tweetArrA.push(picA);
              tweetArrB.push(picB);
              var i = [Math.floor(Math.random()*tweetArrA.length)];
              $("#pic-A").empty();
              $("#pic-B").empty();
              picADiv.html("<p>Pic A:</p><img src=" + tweetArrA[i] +">");
              picBDiv.html("<p>Pic B:</p><img src=" + tweetArrB[i] +">");
              $("#pic-A").append(picADiv);
              $("#pic-B").append(picBDiv);
            };
          };
        });
      });
    };

    //listens for click on images
    $("#pic-A").click(vote);
    $("#pic-B").click(vote);

    //This will log a vote for whatever pic is clicked on, it will then repopulate the divs with new pics
    //Need to add the functionality to actually tally the votes for the winning pic to the database
    function vote() {
      console.log(this.id);
      compareAB();
    };

    compareAB();

  </script>
